"use strict";(("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner=("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner||[]).push([[3589],{63589:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(9661),s=n(54533),i=n(36926),o=n(53334),r=n(87574),l=n(75576),c=n(33283),u=n(2784),m=n(35185),d=n(92936),f=n(95798),h=n(12798),E=n(81345),g=n(92280),x=n(99656),b=n(72558),v=n(94344),N=n(96217),O=n(73557),p=n(38338),j=n(68774),P=n(52274),S=n(94684),k=n(55446),T=n(3612),M=n(52322),A=function(e){return e.VALUE="amount",e.NOMINATE="nominate",e.POOL="pool",e.TYPE="type",e}(A||{});const y=(0,p.ZP)((e=>{const{className:t}=e,{t:n}=(0,N.$)(),{chain:p,type:y}=(0,O.UO)(),I=(0,u.useContext)(l.R0),{isWebUI:L}=(0,u.useContext)(T.sG),{setStakingType:W}=(0,O.bx)(),{asset:w,chain:C,from:Z,onDone:D,setAsset:Q,setChain:B,setDisabledRightBtn:_,setFrom:R,setShowRightBtn:V}=(0,u.useContext)(k.TransactionContext),{nominationPoolInfoMap:F,validatorInfoMap:U}=(0,c.v9)((e=>e.bonding)),Y=(0,c.v9)((e=>e.chainStore.chainInfoMap)),q=(0,c.wE)(C),z=(0,c.v9)((e=>e.accountState.currentAccount)),H=function(e){const t=(0,m.v9)((e=>e.assetRegistry.assetRegistry));return(0,u.useMemo)((()=>t[e]),[t,e])}(w),J=(0,j.u)(null==z?void 0:z.address),X=(0,u.useMemo)((()=>{if(J)return a.WQ.NOMINATED;switch(y){case a.WQ.POOLED:return a.WQ.POOLED;case a.WQ.NOMINATED:return a.WQ.NOMINATED;default:return a.WQ.POOLED}}),[y,J]),[G]=h.Z.useForm(),[K,$]=(0,u.useState)(!0),ee=h.Z.useWatch(A.TYPE,G);(0,u.useEffect)((()=>{W&&W(ee)}),[ee]);const te=(0,c.aJ)(C),ne=(0,c._y)(C,ee,Z),ae=(0,u.useMemo)((()=>ne[0]),[ne]),{nativeTokenBalance:se}=(0,c.L5)(C,Z),ie=(0,c.O_)(ee,Z,p),oe=(0,u.useMemo)((()=>s.H_.relay.includes(C)),[C]),[re,le]=(0,u.useState)(!1),[ce,ue]=(0,u.useState)(!1),[me,de]=(0,u.useState)(!1),[fe,he]=(0,u.useState)(!0),[Ee,ge]=(0,u.useState)(!1),[,xe]=(0,u.useState)({}),be=(0,u.useMemo)((()=>H&&H.minAmount||"0"),[H]),ve=(0,u.useMemo)((()=>{const e=new b.Z(se.value),t=new b.Z(be);return t.gte(e)?"0":e.minus(t).toString()}),[be,se.value]),{decimals:Ne,symbol:Oe}=(0,c.cR)(C),pe=(0,f.W_)((null==z?void 0:z.address)||""),je=(0,c.uH)(p||""),Pe=(0,u.useMemo)((()=>({asset:je,from:Z,chain:C,[A.VALUE]:"0",[A.POOL]:"",[A.NOMINATE]:"",[A.TYPE]:X})),[je,Z,X,C]),Se=(0,u.useMemo)((()=>ee===a.WQ.POOLED?(null==te?void 0:te.minPoolBonding)||"0":(null==te?void 0:te.minStake)||"0"),[null==te?void 0:te.minPoolBonding,null==te?void 0:te.minStake,ee]),{onError:ke,onSuccess:Te}=(0,c.Ls)(D),Me=(0,u.useCallback)(((e,t)=>{const{error:n}=(0,f.ij)(t),s=(0,f.eW)(t),o=(0,f.eW)(e),{amount:r,asset:l,from:c}=o;if(r&&ge(!0),c&&R(c),void 0!==l){const e=(0,i.QJ)(l);Q(l),B(e)}const u={},m=s[A.TYPE];for(const[e,t]of Object.entries(s))u[e]=!!t;m===a.WQ.NOMINATED?u.pool=!0:m===a.WQ.POOLED&&(u.nominate=!0),$(n||Object.values(u).some((e=>!e)))}),[Q,B,R]),Ae=(0,u.useCallback)((e=>{const t=U[C];if(!t)return[];const n=[];return t.forEach((t=>{e.includes((0,f.k1)(t.address,42))&&n.push(t)})),n}),[C,U]),ye=(0,u.useCallback)((e=>{const t=F[C];for(const n of t)if(String(n.id)===e)return n}),[F,C]),Ie=(0,u.useCallback)((e=>{le(!0);const{from:t,[A.NOMINATE]:n,[A.POOL]:s,[A.VALUE]:i,[A.TYPE]:o}=e;let r;if(s&&o===a.WQ.POOLED){const e=ye(s);r=(0,d.qg)({amount:i,chain:C,nominatorMetadata:ae,selectedPool:e,address:t})}else{const e=Ae((0,f.in)(n));r=(0,d.Qx)({amount:i,chain:C,nominatorMetadata:ae,selectedValidators:e,address:t,type:a.WQ.NOMINATED})}setTimeout((()=>{r.then(Te).catch(ke).finally((()=>{le(!1)}))}),300)}),[ye,C,ae,Ae,Te,ke]),Le=(0,u.useCallback)((()=>te?(0,M.jsxs)(o.oB,{className:"meta-info",labelColorScheme:"gray",spaceSize:"xs",valueColorScheme:"light",children:[te.expectedReturn&&(0,M.jsx)(o.oB.Number,{label:n("Estimated earnings:"),suffix:"% / year",value:te.expectedReturn}),te.minStake&&(0,M.jsx)(o.oB.Number,{decimals:Ne,label:n("Minimum active:"),suffix:Oe,value:Se,valueColorSchema:"success"})]}):null),[te,Ne,Oe,n,Se]),We=(0,c.Ey)(Z);return(0,u.useEffect)((()=>{const e=(null==z?void 0:z.address)||"";e&&((0,f.W_)(e)||R(e))}),[null==z?void 0:z.address,R]),(0,u.useEffect)((()=>{p&&p!==r.EN&&B(p)}),[B,p]),(0,u.useEffect)((()=>{Q(je)}),[je,Q]),(0,u.useEffect)((()=>{V(!0)}),[V]),(0,u.useEffect)((()=>{_(!te)}),[te,_]),(0,u.useEffect)((()=>{let e=!1;return C&&Z&&null!=q&&q.active&&(0,P.x1)(C,y||r.EN,e,ue,de),()=>{e=!0}}),[Z,y,C,null==q?void 0:q.active]),(0,u.useEffect)((()=>{let e=!1;return Ee&&(e||setTimeout((()=>{G.validateFields([A.VALUE]).finally((()=>xe({})))}),100)),()=>{e=!0}}),[G,se.value]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.tc,{children:(0,M.jsxs)(o.FE,{className:t,resolve:I.awaitStores(["staking"]),children:[(0,M.jsxs)(h.Z,{className:"form-container form-space-sm",form:G,initialValues:Pe,onFieldsChange:Me,onFinish:Ie,children:[(0,M.jsx)(h.Z.Item,{className:"staking-type",hidden:y!==r.EN,name:A.TYPE,children:(0,M.jsx)(o.Ee,{optionType:"button",options:[{label:"Pools",value:a.WQ.POOLED,disabled:J},{label:"Nominate",value:a.WQ.NOMINATED}]})}),(0,M.jsx)(h.Z.Item,{hidden:!pe,name:"from",children:(0,M.jsx)(o.pK,{filter:(0,P.nC)(Y,ee,p)})}),!pe&&(0,M.jsx)(h.Z.Item,{name:"asset",children:(0,M.jsx)(o.kB,{disabled:p!==r.EN||!Z,items:ie,prefixShape:"circle"})}),(0,M.jsx)(S.ZL,{address:Z,chain:C,className:"account-free-balance",label:n("Available balance:"),onBalanceReady:he}),(0,M.jsxs)("div",{className:"form-row",children:[pe&&(0,M.jsx)(h.Z.Item,{name:"asset",children:(0,M.jsx)(o.kB,{disabled:p!==r.EN||!Z,items:ie,prefixShape:"circle"})}),(0,M.jsx)(h.Z.Item,{name:A.VALUE,rules:[{required:!0},({getFieldValue:e})=>({validator:(t,s)=>{const i=e(A.TYPE),o=new b.Z(s);if(i===a.WQ.POOLED){if(o.lte(0))return Promise.reject(new Error("Amount must be greater than 0"))}else if((null==ae||!ae.isBondedBefore||!oe)&&o.lte(0))return Promise.reject(new Error("Amount must be greater than 0"));return o.gt(se.value)?Promise.reject(n("Amount cannot exceed your balance")):Promise.resolve()}})],statusHelpAsTooltip:!0,children:(0,M.jsx)(o._Z,{decimals:C&&Z?Ne:-1,maxValue:ve,showMaxButton:!1})})]}),(0,M.jsx)(h.Z.Item,{hidden:ee!==a.WQ.POOLED,name:A.POOL,children:(0,M.jsx)(o.Tz,{chain:C,from:Z,label:n("Select pool"),loading:ce})}),(0,M.jsx)(h.Z.Item,{hidden:ee!==a.WQ.NOMINATED,name:A.NOMINATE,children:(0,M.jsx)(o.OF,{chain:w?C:"",from:w?Z:"",loading:me})})]}),te&&!L&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(E.Z,{className:"staking-divider"}),Le()]})]})}),(0,M.jsx)(S.Xd,{errors:[],warnings:[],children:(0,M.jsx)(g.Z,{disabled:K||!fe,icon:(0,M.jsx)(x.Z,{phosphorIcon:v.Z,weight:"fill"}),loading:re,onClick:We(G.submit),children:n("Stake")})}),te&&(0,M.jsx)(o.R5,{activeNominators:te.nominatorCount,estimatedEarning:te.expectedReturn,inflation:te.inflation,maxValidatorPerNominator:te.maxValidatorPerNominator,minimumActive:{decimals:Ne,value:Se,symbol:Oe},stakingType:ee,unstakingPeriod:te.unstakingPeriod})]})})).withConfig({displayName:"Stake",componentId:"sc-abqz0v-0"})((({theme:{token:e}})=>({".staking-type":{marginBottom:e.margin},".account-free-balance":{marginBottom:e.marginXS},".meta-info":{marginTop:e.paddingSM},".react-tabs__tab-list":{marginLeft:0,marginRight:0},".staking-divider":{marginTop:e.margin+2,marginBottom:e.marginSM}})))}}]);