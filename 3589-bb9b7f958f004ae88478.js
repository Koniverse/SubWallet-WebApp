"use strict";(("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner=("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner||[]).push([[3589],{63589:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a,s=n(9661),i=n(54533),o=n(36926),r=n(53334),l=n(13825),c=n(75576),u=n(3612),m=n(33283),d=n(2784),f=n(35185),h=n(92936),E=n(95798),x=n(12798),g=n(81345),b=n(92280),N=n(99656),v=n(72558),O=n(94344),p=n(21427),j=n(73557),P=n(38338),S=n(68774),k=n(52274),T=n(94684),M=n(55446),A=n(52322);!function(e){e.VALUE="amount",e.NOMINATE="nominate",e.POOL="pool",e.TYPE="type"}(a||(a={}));const y=(0,P.ZP)((e=>{const{className:t}=e,{t:n}=(0,p.$)(),{chain:P,type:y}=(0,j.UO)(),I=(0,d.useContext)(c.R0),{isWebUI:L}=(0,d.useContext)(u.sG),{setStakingType:W}=(0,j.bx)(),{asset:w,chain:C,from:Z,onDone:D,setAsset:Q,setChain:B,setDisabledRightBtn:_,setFrom:R,setShowRightBtn:V}=(0,d.useContext)(M.TransactionContext),{nominationPoolInfoMap:F,validatorInfoMap:U}=(0,m.v9)((e=>e.bonding)),Y=(0,m.v9)((e=>e.chainStore.chainInfoMap)),J=(0,m.wE)(C),q=(0,m.v9)((e=>e.accountState.currentAccount)),z=function(e){const t=(0,f.v9)((e=>e.assetRegistry.assetRegistry));return(0,d.useMemo)((()=>t[e]),[t,e])}(w),H=(0,S.u)(null==q?void 0:q.address),X=(0,d.useMemo)((()=>{if(H)return s.WQ.NOMINATED;switch(y){case s.WQ.POOLED:return s.WQ.POOLED;case s.WQ.NOMINATED:return s.WQ.NOMINATED;default:return s.WQ.POOLED}}),[y,H]),[G]=x.Z.useForm(),[K,$]=(0,d.useState)(!0),ee=x.Z.useWatch(a.TYPE,G);(0,d.useEffect)((()=>{W&&W(ee)}),[ee]);const te=(0,m.aJ)(C),ne=(0,m._y)(C,ee,Z),ae=(0,d.useMemo)((()=>ne[0]),[ne]),{nativeTokenBalance:se}=(0,m.L5)(C,Z),ie=(0,m.O_)(ee,Z,P),oe=(0,d.useMemo)((()=>i.H_.relay.includes(C)),[C]),[re,le]=(0,d.useState)(!1),[ce,ue]=(0,d.useState)(!1),[me,de]=(0,d.useState)(!1),[fe,he]=(0,d.useState)(!0),[Ee,xe]=(0,d.useState)(!1),[,ge]=(0,d.useState)({}),be=(0,d.useMemo)((()=>z&&z.minAmount||"0"),[z]),Ne=(0,d.useMemo)((()=>{const e=new v.Z(se.value),t=new v.Z(be);return t.gte(e)?"0":e.minus(t).toString()}),[be,se.value]),{decimals:ve,symbol:Oe}=(0,m.cR)(C),pe=(0,E.W_)((null==q?void 0:q.address)||""),je=(0,m.uH)(P||""),Pe=(0,d.useMemo)((()=>({asset:je,from:Z,chain:C,[a.VALUE]:"0",[a.POOL]:"",[a.NOMINATE]:"",[a.TYPE]:X})),[je,Z,X,C]),Se=(0,d.useMemo)((()=>ee===s.WQ.POOLED?(null==te?void 0:te.minJoinNominationPool)||"0":(null==te?void 0:te.minStake)||"0"),[null==te?void 0:te.minJoinNominationPool,null==te?void 0:te.minStake,ee]),{onError:ke,onSuccess:Te}=(0,m.Ls)(D),Me=(0,d.useCallback)(((e,t)=>{const{error:n}=(0,E.ij)(t),i=(0,E.eW)(t),r=(0,E.eW)(e),{amount:l,asset:c,from:u}=r;if(l&&xe(!0),u&&R(u),void 0!==c){const e=(0,o.QJ)(c);Q(c),B(e)}const m={},d=i[a.TYPE];for(const[e,t]of Object.entries(i))m[e]=!!t;d===s.WQ.NOMINATED?m.pool=!0:d===s.WQ.POOLED&&(m.nominate=!0),$(n||Object.values(m).some((e=>!e)))}),[Q,B,R]),Ae=(0,d.useCallback)((e=>{const t=U[C];if(!t)return[];const n=[];return t.forEach((t=>{e.includes((0,E.k1)(t.address,42))&&n.push(t)})),n}),[C,U]),ye=(0,d.useCallback)((e=>{const t=F[C];for(const n of t)if(String(n.id)===e)return n}),[F,C]),Ie=(0,d.useCallback)((e=>{le(!0);const{from:t,[a.NOMINATE]:n,[a.POOL]:i,[a.VALUE]:o,[a.TYPE]:r}=e;let l;if(i&&r===s.WQ.POOLED){const e=ye(i);l=(0,h.qg)({amount:o,chain:C,nominatorMetadata:ae,selectedPool:e,address:t})}else{const e=Ae((0,E.in)(n));l=(0,h.Qx)({amount:o,chain:C,nominatorMetadata:ae,selectedValidators:e,address:t,type:s.WQ.NOMINATED})}setTimeout((()=>{l.then(Te).catch(ke).finally((()=>{le(!1)}))}),300)}),[ye,C,ae,Ae,Te,ke]),Le=(0,d.useCallback)((()=>te?(0,A.jsxs)(r.oB,{className:"meta-info",labelColorScheme:"gray",spaceSize:"xs",valueColorScheme:"light",children:[te.expectedReturn&&(0,A.jsx)(r.oB.Number,{label:n("Estimated earnings:"),suffix:"% / year",value:te.expectedReturn}),te.minStake&&(0,A.jsx)(r.oB.Number,{decimals:ve,label:n("Minimum active:"),suffix:Oe,value:Se,valueColorSchema:"success"})]}):null),[te,ve,Oe,n,Se]),We=(0,m.Ey)(Z);return(0,d.useEffect)((()=>{const e=(null==q?void 0:q.address)||"";e&&((0,E.W_)(e)||R(e))}),[null==q?void 0:q.address,R]),(0,d.useEffect)((()=>{P&&P!==l.EN&&B(P)}),[B,P]),(0,d.useEffect)((()=>{Q(je)}),[je,Q]),(0,d.useEffect)((()=>{V(!0)}),[V]),(0,d.useEffect)((()=>{_(!te)}),[te,_]),(0,d.useEffect)((()=>{let e=!1;return C&&Z&&null!=J&&J.active&&(0,k.x1)(C,y||l.EN,e,ue,de),()=>{e=!0}}),[Z,y,C,null==J?void 0:J.active]),(0,d.useEffect)((()=>{let e=!1;return Ee&&(e||setTimeout((()=>{G.validateFields([a.VALUE]).finally((()=>ge({})))}),100)),()=>{e=!0}}),[G,se.value]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(T.tc,{children:(0,A.jsxs)(r.FE,{className:t,resolve:I.awaitStores(["staking"]),children:[(0,A.jsxs)(x.Z,{className:"form-container form-space-sm",form:G,initialValues:Pe,onFieldsChange:Me,onFinish:Ie,children:[(0,A.jsx)(x.Z.Item,{className:"staking-type",hidden:y!==l.EN,name:a.TYPE,children:(0,A.jsx)(r.Ee,{optionType:"button",options:[{label:"Pools",value:s.WQ.POOLED,disabled:H},{label:"Nominate",value:s.WQ.NOMINATED}]})}),(0,A.jsx)(x.Z.Item,{hidden:!pe,name:"from",children:(0,A.jsx)(r.pK,{filter:(0,k.nC)(Y,ee,P)})}),!pe&&(0,A.jsx)(x.Z.Item,{name:"asset",children:(0,A.jsx)(r.kB,{disabled:P!==l.EN||!Z,items:ie,prefixShape:"circle"})}),(0,A.jsx)(T.ZL,{address:Z,chain:C,className:"account-free-balance",label:n("Available balance:"),onBalanceReady:he}),(0,A.jsxs)("div",{className:"form-row",children:[pe&&(0,A.jsx)(x.Z.Item,{name:"asset",children:(0,A.jsx)(r.kB,{disabled:P!==l.EN||!Z,items:ie,prefixShape:"circle"})}),(0,A.jsx)(x.Z.Item,{name:a.VALUE,rules:[{required:!0},({getFieldValue:e})=>({validator:(t,i)=>{const o=e(a.TYPE),r=new v.Z(i);if(o===s.WQ.POOLED){if(r.lte(0))return Promise.reject(new Error("Amount must be greater than 0"))}else if((null==ae||!ae.isBondedBefore||!oe)&&r.lte(0))return Promise.reject(new Error("Amount must be greater than 0"));return r.gt(se.value)?Promise.reject(n("Amount cannot exceed your balance")):Promise.resolve()}})],statusHelpAsTooltip:!0,children:(0,A.jsx)(r._Z,{decimals:C&&Z?ve:-1,maxValue:Ne,showMaxButton:!1})})]}),(0,A.jsx)(x.Z.Item,{hidden:ee!==s.WQ.POOLED,name:a.POOL,children:(0,A.jsx)(r.Tz,{chain:C,from:Z,label:n("Select pool"),loading:ce})}),(0,A.jsx)(x.Z.Item,{hidden:ee!==s.WQ.NOMINATED,name:a.NOMINATE,children:(0,A.jsx)(r.OF,{chain:w?C:"",from:w?Z:"",loading:me})})]}),te&&!L&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(g.Z,{className:"staking-divider"}),Le()]})]})}),(0,A.jsx)(T.Xd,{errors:[],warnings:[],children:(0,A.jsx)(b.Z,{disabled:K||!fe,icon:(0,A.jsx)(N.Z,{phosphorIcon:O.Z,weight:"fill"}),loading:re,onClick:We(G.submit),children:n("Stake")})}),te&&(0,A.jsx)(r.R5,{activeNominators:te.nominatorCount,estimatedEarning:te.expectedReturn,inflation:te.inflation,maxValidatorPerNominator:te.maxValidatorPerNominator,minimumActive:{decimals:ve,value:Se,symbol:Oe},stakingType:ee,unstakingPeriod:te.unstakingPeriod})]})})).withConfig({displayName:"Stake",componentId:"sc-abqz0v-0"})((({theme:{token:e}})=>({".staking-type":{marginBottom:e.margin},".account-free-balance":{marginBottom:e.marginXS},".meta-info":{marginTop:e.paddingSM},".react-tabs__tab-list":{marginLeft:0,marginRight:0},".staking-divider":{marginTop:e.margin+2,marginBottom:e.marginSM}})))}}]);