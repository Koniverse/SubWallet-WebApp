"use strict";(("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner=("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner||[]).push([[6459],{15875:(e,a,t)=>{t.d(a,{D1:()=>u,Ff:()=>c,Kn:()=>h,VN:()=>d,k2:()=>m,tA:()=>r});var n=t(9661),i=t(54533),l=t(62197),s=t.n(l),o=t(95292);function r(e){return i.H_.amplitude.includes(e)?"showByValue":i.H_.astar.includes(e)?"mixed":i.H_.para.includes(e)?"showByValidator":"showByValue"}let c=function(e){return e.STAKE="STAKE",e.UNSTAKE="UNSTAKE",e.WITHDRAW="WITHDRAW",e.CLAIM_REWARD="CLAIM_REWARD",e.CANCEL_UNSTAKE="CANCEL_UNSTAKE",e}({});function d(e,a){return a===n.WQ.POOLED?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CLAIM_REWARD]:i.H_.para.includes(e)?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CANCEL_UNSTAKE]:i.H_.astar.includes(e)?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CLAIM_REWARD]:i.H_.amplitude.includes(e)?[c.STAKE,c.UNSTAKE,c.WITHDRAW]:[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CANCEL_UNSTAKE]}function u(e,a){const t=[c.STAKE],l=new(s())(e.activeStake);if(e.activeStake&&l.gt(o.nw)){t.push(c.UNSTAKE);const l=i.H_.astar.includes(e.chain),r=i.H_.amplitude.includes(e.chain),d=new(s())(a||"0");((e.type===n.WQ.POOLED||r)&&d.gt(o.nw)||l)&&t.push(c.CLAIM_REWARD)}if(e.unstakings.length>0){t.push(c.CANCEL_UNSTAKE);let a=!1;for(const t of e.unstakings)if(t.status===n.lz.CLAIMABLE){a=!0;break}a&&t.push(c.WITHDRAW)}return t}function m(e,a){return!(e===n.WQ.POOLED||!i.H_.astar.includes(a)&&!i.H_.amplitude.includes(a)&&!i.H_.para.includes(a))}function h(e){const a=e.unstakings;let t;for(const e of a)if(e.status===n.lz.CLAIMABLE){t=e;break}return t}},86459:(e,a,t)=>{t.r(a),t.d(a,{Staking:()=>q,default:()=>ee});var n=t(9661),i=t(18906),l=t(87574),s=t(75576),o=t(33283),r=t(92936),c=t(99656),d=t(12162),u=t(96108),m=t(17446),h=t(50094),k=t(16418),v=t(69339),g=t(39359),p=t(2784),f=t(73557),b=t(38338),x=t(15875),C=t(80039),A=t(1072),N=t(58094),S=t(72779),_=t.n(S),E=t(96777),T=t(4595),w=t(47856),y=t(61910),I=t(94344),j=t(96217),Z=t(52322);const W="more-action-modal";(0,b.ZP)((e=>{const{chainStakingMetadata:a,className:t,nominatorMetadata:i,reward:s}=e,c=(0,f.s0)(),{token:m}=(0,b.Fg)(),{t:h}=(0,j.$)(),{inactiveModal:k}=(0,p.useContext)(d.t),{currentAccount:v,isAllAccount:g}=(0,o.v9)((e=>e.accountState)),[S,R]=(0,p.useState)(),M=(0,p.useCallback)((()=>{k(W)}),[k]),D=(0,p.useCallback)((e=>{a&&c(`/transaction-done/substrate/${a.chain}/${e}`)}),[a,c]),{onError:L,onSuccess:$}=(0,o.Ls)(D),K=(0,p.useCallback)((()=>{if(!i)return void R(void 0);if(g)return R(void 0),void c(`/transaction/withdraw/${i.type}/${i.chain}`);const e=(0,x.Kn)(i);if(!e)return void R(void 0);const a={unstakingInfo:e,chain:i.chain,nominatorMetadata:i};(0,x.k2)(i.type,i.chain)&&(a.validatorAddress=e.validatorAddress),(0,r.E_)(a).then($).catch(L).finally((()=>{R(void 0)}))}),[g,c,i,L,$]),O=(0,p.useCallback)((()=>{if(i)return i.type===n.WQ.POOLED||g?(R(void 0),void c(`/transaction/claim-reward/${i.type}/${i.chain}`)):void(0,r.QQ)({address:i.address,chain:i.chain,stakingType:i.type,unclaimedReward:null==s?void 0:s.unclaimedReward}).then($).catch(L).finally((()=>{R(void 0)}));R(void 0)}),[g,c,i,L,$,null==s?void 0:s.unclaimedReward]),H=(0,p.useMemo)((()=>i?(0,x.D1)(i,null==s?void 0:s.unclaimedReward):[]),[i,null==s?void 0:s.unclaimedReward]),F=(0,p.useCallback)((e=>()=>{R(void 0),c(e)}),[c]),U=(0,p.useMemo)((()=>a?(0,x.VN)(a.chain,a.type).map((e=>e===x.Ff.UNSTAKE?{action:x.Ff.UNSTAKE,backgroundIconColor:"magenta-6",icon:E.Z,label:"Unstake funds",onClick:F(`/transaction/unstake/${a.type||l.EN}/${a.chain||l.EN}`)}:e===x.Ff.WITHDRAW?{action:x.Ff.WITHDRAW,backgroundIconColor:"geekblue-6",icon:T.Z,label:"Withdraw",onClick:K}:e===x.Ff.CLAIM_REWARD?{action:x.Ff.CLAIM_REWARD,backgroundIconColor:"green-7",icon:w.Z,label:"Claim rewards",onClick:O}:e===x.Ff.CANCEL_UNSTAKE?{action:x.Ff.CANCEL_UNSTAKE,backgroundIconColor:"purple-8",icon:y.Z,label:"Cancel unstake",onClick:F(`/transaction/cancel-unstake/${a.type||l.EN}/${a.chain||l.EN}`)}:{action:x.Ff.STAKE,backgroundIconColor:"green-6",icon:I.Z,label:"Stake more",onClick:F(`/transaction/stake/${a.type||l.EN}/${a.chain||l.EN}`)})):[]),[a,O,K,F]),B=(0,o.Ey)(null==v?void 0:v.address),P=(0,p.useCallback)(((e,a)=>{const t=()=>{R(e),a()};return()=>{B(t)()}}),[B]);return(0,Z.jsx)(C.ZP,{className:t,closable:!0,id:W,maskClosable:!0,onCancel:S?void 0:M,title:h("Actions"),children:U.map((e=>{const a=!H.includes(e.action),t=!!S,n=e.action===S,i=a||t&&!n;return(0,Z.jsx)(A.Z,{className:_()("action-more-item",{disabled:i}),leftItemIcon:(0,Z.jsx)(N.Z,{backgroundColor:m[e.backgroundIconColor],phosphorIcon:e.icon,size:"sm",weight:"fill"}),name:e.label,onPressItem:i?void 0:P(e.action,e.onClick),rightItem:n&&(0,Z.jsx)("div",{className:"loading-icon",children:(0,Z.jsx)(u.Z,{})})},e.label)}))})})).withConfig({displayName:"MoreActionModal",componentId:"sc-17oe78l-0"})((({theme:{token:e}})=>({".action-more-item:not(:last-child)":{marginBottom:e.marginXS},".ant-web3-block-right-item":{marginRight:0},".disabled":{cursor:"not-allowed",opacity:e.opacityDisable,".ant-web3-block":{cursor:"not-allowed"},".ant-web3-block:hover":{cursor:"not-allowed",background:e.colorBgSecondary}}})));var R=t(38014),M=t(54533),D=t(36926),L=t(60835),$=t(20029),K=t(58446),O=t(71871),H=t(11164),F=t(95798),U=t(92280),B=t(25690),P=t(89537),z=t(27136);const Q="staking-detail-modal-id";(0,b.ZP)((({chainStakingMetadata:e,className:a,nominatorMetadata:t,rewardItem:i,staking:l})=>{const{expectedReturn:s,minPoolBonding:r,minStake:u,unstakingPeriod:m}=e,{activeStake:h,address:k,chain:v,nominations:g,type:A,unstakings:N}=t,S=(0,x.tA)(v),E=M.H_.relay.includes(v),T=A===n.WQ.NOMINATED.valueOf()?"Nomination details":"Pooled details",{token:w}=(0,b.Fg)(),y=(0,f.s0)(),{t:I}=(0,j.$)(),[G,V]=(0,p.useState)(!1),{activeModal:X,inactiveModal:Y}=(0,p.useContext)(d.t),{currentAccount:J}=(0,o.v9)((e=>e.accountState)),q=(0,o.Ey)(null==J?void 0:J.address),ee=(0,O.Z)(l.chain),{decimals:ae}=(0,D.Nm)(ee),te=(0,D.GS)(ee),ne=(0,o.AT)(l.address),ie={nominated:I("Nominated"),pooled:I("Pooled")},le=(0,p.useCallback)((()=>{Y(Q),setTimeout((()=>{y(`/transaction/stake/${t.type}/${t.chain}`)}),300)}),[Y,y,t]),se=(0,p.useCallback)((()=>{Y(Q),setTimeout((()=>y(`/transaction/unstake/${t.type}/${t.chain}`)),300)}),[Y,y,t]),oe=(0,p.useCallback)((()=>{X(W),Y(Q)}),[X,Y]),re=(0,p.useCallback)((()=>{V(!0)}),[]),ce=(0,p.useCallback)((()=>{V(!1),Y(Q)}),[Y]),de=(0,p.useCallback)((e=>e===n.dE.EARNING_REWARD?K.C.active:e===n.dE.PARTIALLY_EARNING?K.C.partialEarning:e===n.dE.WAITING?K.C.waiting:K.C.inactive),[]),ue=(0,p.useCallback)((e=>{const a=((e,a)=>e.find((e=>e.validatorAddress===a)))(N,e.validatorAddress);return(0,Z.jsxs)(L.Z,{hasBackgroundWrapper:!0,spaceSize:"sm",valueColorScheme:"light",children:[(0,Z.jsx)(L.Z.Account,{address:e.validatorAddress,label:I("Validator"),name:e.validatorIdentity||(0,F.pC)(e.validatorAddress),networkPrefix:te}),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Active staked"),suffix:l.nativeToken,value:e.activeStake||"",valueColorSchema:"gray"},e.validatorAddress),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Min stake"),suffix:l.nativeToken,value:e.validatorMinStake||"0",valueColorSchema:"gray"},e.validatorAddress),!!a&&"showByValidator"===S&&(0,Z.jsx)(L.Z.Default,{className:"__para",label:I("Unstaked"),labelAlign:a.status===n.lz.UNLOCKING.valueOf()?"top":"center",children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)(B.Z,{className:"common-text text-light-4 text-right",decimal:ae,suffix:l.nativeToken,value:a.claimable}),a.status===n.lz.UNLOCKING.valueOf()&&(0,Z.jsx)("div",{className:"sm-text text-light-4",children:(0,H.H9)(a.waitingTime)})]})}),(0,Z.jsx)(L.Z.Status,{label:I("Staking status"),statusIcon:de(e.status).icon,statusName:de(e.status).name,valueColorSchema:de(e.status).schema})]},e.validatorAddress)}),[ae,de,te,S,l.nativeToken,I,N]);return(0,Z.jsxs)(C.ZP,{className:a,closable:!0,footer:(0,Z.jsxs)("div",{className:"staking-detail-modal-footer",children:[(0,Z.jsx)(U.Z,{icon:(0,Z.jsx)(c.Z,{phosphorIcon:P.Z}),onClick:oe,schema:"secondary"}),(0,Z.jsx)(U.Z,{className:"__action-btn",onClick:q(se),schema:"secondary",children:I("Unstake")}),(0,Z.jsx)(U.Z,{className:"__action-btn",onClick:q(le),children:I("Stake more")})]}),id:Q,maskClosable:!0,onCancel:ce,title:I(T),children:[(0,Z.jsxs)(L.Z,{children:[(0,Z.jsx)(L.Z.Account,{address:k,label:I("Account"),name:null==ne?void 0:ne.name}),(0,Z.jsx)(L.Z.DisplayType,{label:I("Staking type"),typeName:ie[l.type]}),(0,Z.jsx)(L.Z.Status,{label:A===n.WQ.NOMINATED?I("Nomination status"):I("Pooled status"),statusIcon:de(t.status).icon,statusName:de(t.status).name,valueColorSchema:de(t.status).schema}),!(null==i||!i.totalReward)&&parseFloat(null==i?void 0:i.totalReward)>0&&(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Total reward"),suffix:l.nativeToken,value:(null==i?void 0:i.totalReward)||"0"}),!(null==i||!i.unclaimedReward)&&parseFloat(null==i?void 0:i.unclaimedReward)>0&&(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Unclaimed reward"),suffix:l.nativeToken,value:(null==i?void 0:i.unclaimedReward)||"0"}),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Total staked"),suffix:l.nativeToken,value:String(parseFloat(h)+parseFloat(l.unlockingBalance||"0"))}),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Active staked"),suffix:l.nativeToken,value:h}),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Unstaked"),suffix:l.nativeToken,value:l.unlockingBalance||"0"}),(0,Z.jsx)(L.Z.Chain,{chain:l.chain,label:I("Network")})]}),!G&&(0,Z.jsx)(U.Z,{block:!0,className:"see-more-btn",icon:(0,Z.jsx)(c.Z,{iconColor:w.colorTextLight4,phosphorIcon:z.Z,size:"sm"}),onClick:re,size:"xs",type:"ghost",children:I("See more")}),G&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(L.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:[!!s&&(0,Z.jsx)(L.Z.Number,{label:I("Estimated earning"),suffix:"%",value:s,valueColorSchema:"even-odd"}),(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Minimum active"),suffix:l.nativeToken,value:t.type===n.WQ.NOMINATED?u:r||"0",valueColorSchema:"gray"}),!!m&&(0,Z.jsx)(L.Z.Default,{label:I("Unstaking period"),valueColorSchema:"gray",children:(0,H.b_)(m)})]}),"showByValue"===S&&g&&g.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(L.Z,{valueColorScheme:"light",children:(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Active staked"),suffix:l.nativeToken,value:h})}),(0,Z.jsx)(L.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:(0,Z.jsx)(Z.Fragment,{children:g.map((e=>E&&A===n.WQ.NOMINATED?(0,Z.jsx)(L.Z.Default,{className:_()("__nomination-field","stand-alone"),label:(0,Z.jsx)($.Z,{address:e.validatorAddress,className:"__nomination-label",name:e.validatorIdentity})},`${e.validatorAddress}-${e.activeStake}-${e.validatorIdentity||e.validatorMinStake||e.chain}`):(0,Z.jsx)(L.Z.Number,{className:"__nomination-field",decimals:ae,label:(0,Z.jsx)($.Z,{address:e.validatorAddress,className:"__nomination-label",name:e.validatorIdentity}),suffix:l.nativeToken,value:e.activeStake||"",valueColorSchema:"gray"},`${e.validatorAddress}-${e.activeStake}-${e.validatorIdentity||e.validatorMinStake||e.chain}`)))})})]}),("showByValue"===S||"mixed"===S)&&N&&N.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(L.Z,{valueColorScheme:"light",children:(0,Z.jsx)(L.Z.Number,{decimals:ae,label:I("Unstaked"),suffix:l.nativeToken,value:l.unlockingBalance||"0"})}),(0,Z.jsx)(L.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:(0,Z.jsx)(Z.Fragment,{children:N.map((e=>(0,Z.jsx)(L.Z.Number,{decimals:ae,label:(0,H.H9)(e.waitingTime)?I((0,H.H9)(e.waitingTime)):I("Withdraw"),suffix:l.nativeToken,value:e.claimable||"",valueColorSchema:"gray"},`${e.validatorAddress||e.chain}-${e.status}-${e.claimable}`)))})})]}),("showByValidator"===S||"mixed"===S)&&g&&g.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsx)(Z.Fragment,{children:g&&g.length&&g.map((e=>ue(e)))})]})]})})).withConfig({displayName:"StakingDetailModal",componentId:"sc-1al54tx-0"})((({theme:{token:e}})=>({".staking-detail-modal-footer":{display:"flex",alignItems:"center"},".__action-btn":{flex:1},".__slash":{marginLeft:e.marginXXS,marginRight:e.marginXXS},".__inflation-text":{marginLeft:e.marginXXS,color:e.colorTextLight4},".__expected-return, .__inflation":{display:"inline-flex"},".__inflation":{color:e.colorTextLight4},".__nomination-field":{"> .__col":{overflow:"hidden"},"&.stand-alone":{".__col.-to-right":{flexGrow:0}}},".__nomination-label > .__col.-to-right":{flex:"initial",overflow:"hidden",alignItems:"flex-start",".__account-item":{width:"100%"},".__account-name":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},".see-more-btn":{marginTop:e.margin},".ant-sw-modal-body":{paddingBottom:0},".ant-sw-modal-footer":{border:"none"}})));var G=t(3612);const V="staking-filter-modal";var X=function(e){return e.NOMINATED="nominated",e.POOLED="pooled",e}(X||{});n.WQ.NOMINATED,n.WQ.POOLED;const Y=(0,Z.jsx)(c.Z,{phosphorIcon:h.Z,size:"sm",type:"phosphor"}),J=(0,Z.jsx)(c.Z,{phosphorIcon:k.Z,size:"sm",type:"phosphor"}),q=(0,b.ZP)((function({className:e=""}){const a=(0,f.s0)(),{t}=(0,o.$G)(),h=(0,p.useContext)(s.R0),{isWebUI:k}=(0,p.useContext)(G.sG),{activeModal:b,inactiveModal:x}=(0,p.useContext)(d.t),{data:C,priceMap:A}=(0,o.iu)(),{currentAccount:N}=(0,o.v9)((e=>e.accountState)),{filterSelectionMap:S,onApplyFilter:_,onChangeFilterOption:E,onCloseFilterModal:T,selectedFilters:w}=(0,o.RK)(V),[y]=(0,p.useState)(null==N?void 0:N.address),[I,j]=(0,p.useState)(void 0),[R,M]=p.useState(!1),D=(0,o.lm)(),L=(0,p.useMemo)((()=>e=>{if(!w.length)return!0;for(const a of w)if(a===X.NOMINATED){if(e.staking.type===n.WQ.NOMINATED)return!0}else if(a===n.WQ.POOLED&&e.staking.type===n.WQ.POOLED)return!0;return!1}),[w]),$=(0,p.useCallback)((()=>{b(V)}),[b]),K=(0,p.useCallback)((e=>{j(e),b(W)}),[b]),O=(0,p.useCallback)((e=>{j(e),setTimeout((()=>{b(Q)}),100)}),[b]),H=(0,o.Ey)(null==N?void 0:N.address),F=(0,p.useMemo)((()=>[{icon:J,disabled:R,size:"sm",onClick:()=>{M(!0),D({icon:(0,Z.jsx)(u.Z,{size:32}),style:{top:210},direction:"vertical",duration:1.8,message:t("Reloading")}),(0,r.TU)({data:"staking"}).then((()=>{M(!1)})).catch(console.error)}},{icon:Y,onClick:H((()=>a(`/transaction/stake/${l.EN}/${l.EN}`)))}]),[R,H,D,t,a]),U=(0,p.useCallback)((e=>(0,Z.jsx)(i.Jf,{className:"staking-item",decimals:e.decimals,onClickItem:O,onClickRightIcon:K,priceMap:A,stakingData:e},`${e.staking.chain}-${e.staking.type}-${e.staking.address}`)),[O,K,A]),B=(0,p.useCallback)(((e,a)=>{const t=a.toLowerCase();return e.staking.nativeToken.toLowerCase().includes(t)}),[]),P=(0,p.useCallback)((()=>(0,Z.jsx)(i.rf,{emptyMessage:t("Your staking accounts will appear here!"),emptyTitle:t("No staking"),phosphorIcon:v.Z})),[t]);return(0,p.useEffect)((()=>{(null==N?void 0:N.address)!==y&&(x(W),x(Q),j(void 0))}),[y,null==N?void 0:N.address,x,a]),(0,Z.jsx)(i.FE,{className:`staking ${e}`,resolve:h.awaitStores(["staking","price"]),children:(0,Z.jsx)(i.Ar.Base,{...!k&&{title:t("Staking"),subHeaderBackground:"transparent",subHeaderCenter:!1,subHeaderIcons:F,subHeaderPaddingVertical:!0,showSubHeader:!0},children:(0,Z.jsx)(m.Z.Section,{actionBtnIcon:(0,Z.jsx)(c.Z,{phosphorIcon:g.Z,size:"sm"}),enableSearchInput:!0,filterBy:L,list:C,onClickActionBtn:$,renderItem:U,renderWhenEmpty:P,searchFunction:B,searchMinCharactersCount:2,searchPlaceholder:t("Search project"),showActionBtn:!0})})})})).withConfig({displayName:"Staking",componentId:"sc-18loehm-0"})((({theme:{token:e}})=>({color:e.colorTextLight1,fontSize:e.fontSizeLG,".ant-sw-screen-layout-body":{display:"flex"},".ant-sw-list-section":{flex:1},".staking__filter_option":{width:"100%"},".staking__filter_option_wrapper":{display:"flex",flexDirection:"column",gap:e.marginLG},".staking-item":{marginBottom:e.marginXS}}))),ee=q}}]);