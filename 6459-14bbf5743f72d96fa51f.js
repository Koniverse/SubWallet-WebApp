"use strict";(("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner=("undefined"!=typeof self?self:this).webpackChunk_subwallet_web_runner||[]).push([[6459],{15875:(a,e,t)=>{t.d(e,{D1:()=>u,Ff:()=>c,Kn:()=>h,VN:()=>d,k2:()=>m,tA:()=>r});var n=t(9661),i=t(54533),l=t(62197),o=t.n(l),s=t(95292);function r(a){return i.H_.amplitude.includes(a)?"showByValue":i.H_.astar.includes(a)?"mixed":i.H_.para.includes(a)?"showByValidator":"showByValue"}let c=function(a){return a.STAKE="STAKE",a.UNSTAKE="UNSTAKE",a.WITHDRAW="WITHDRAW",a.CLAIM_REWARD="CLAIM_REWARD",a.CANCEL_UNSTAKE="CANCEL_UNSTAKE",a}({});function d(a,e){return e===n.WQ.POOLED?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CLAIM_REWARD]:i.H_.para.includes(a)?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CANCEL_UNSTAKE]:i.H_.astar.includes(a)?[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CLAIM_REWARD]:i.H_.amplitude.includes(a)?[c.STAKE,c.UNSTAKE,c.WITHDRAW]:[c.STAKE,c.UNSTAKE,c.WITHDRAW,c.CANCEL_UNSTAKE]}function u(a,e){const t=[c.STAKE],l=new(o())(a.activeStake);if(a.activeStake&&l.gt(s.nw)){t.push(c.UNSTAKE);const l=i.H_.astar.includes(a.chain),r=i.H_.amplitude.includes(a.chain),d=new(o())(e||"0");((a.type===n.WQ.POOLED||r)&&d.gt(s.nw)||l)&&t.push(c.CLAIM_REWARD)}if(a.unstakings.length>0){t.push(c.CANCEL_UNSTAKE);let e=!1;for(const t of a.unstakings)if(t.status===n.lz.CLAIMABLE){e=!0;break}e&&t.push(c.WITHDRAW)}return t}function m(a,e){return!(a===n.WQ.POOLED||!i.H_.astar.includes(e)&&!i.H_.amplitude.includes(e)&&!i.H_.para.includes(e))}function h(a){const e=a.unstakings;let t;for(const a of e)if(a.status===n.lz.CLAIMABLE){t=a;break}return t}},86459:(a,e,t)=>{t.r(e),t.d(e,{Staking:()=>ea,default:()=>ta});var n=t(9661),i=t(3401),l=t(87574),o=t(75576),s=t(33283),r=t(92936),c=t(99656),d=t(12162),u=t(96108),m=t(17446),h=t(50094),k=t(16418),g=t(69339),v=t(39359),p=t(2784),f=t(73557),b=t(38338),x=t(15875),C=t(80039),A=t(1072),N=t(58094),S=t(72779),_=t.n(S),E=t(96777),T=t(4595),w=t(47856),y=t(61910),I=t(94344),j=t(96217),Z=t(52322);const M="more-action-modal",W=(0,b.ZP)((a=>{const{chainStakingMetadata:e,className:t,nominatorMetadata:i,reward:o}=a,c=(0,f.s0)(),{token:m}=(0,b.Fg)(),{t:h}=(0,j.$)(),{inactiveModal:k}=(0,p.useContext)(d.t),{currentAccount:g,isAllAccount:v}=(0,s.v9)((a=>a.accountState)),[S,W]=(0,p.useState)(),R=(0,p.useCallback)((()=>{k(M)}),[k]),D=(0,p.useCallback)((a=>{e&&c(`/transaction-done/substrate/${e.chain}/${a}`)}),[e,c]),{onError:L,onSuccess:$}=(0,s.Ls)(D),O=(0,p.useCallback)((()=>{if(!i)return void W(void 0);if(v)return W(void 0),void c(`/transaction/withdraw/${i.type}/${i.chain}`);const a=(0,x.Kn)(i);if(!a)return void W(void 0);const e={unstakingInfo:a,chain:i.chain,nominatorMetadata:i};(0,x.k2)(i.type,i.chain)&&(e.validatorAddress=a.validatorAddress),(0,r.E_)(e).then($).catch(L).finally((()=>{W(void 0)}))}),[v,c,i,L,$]),K=(0,p.useCallback)((()=>{if(i)return i.type===n.WQ.POOLED||v?(W(void 0),void c(`/transaction/claim-reward/${i.type}/${i.chain}`)):void(0,r.QQ)({address:i.address,chain:i.chain,stakingType:i.type,unclaimedReward:null==o?void 0:o.unclaimedReward}).then($).catch(L).finally((()=>{W(void 0)}));W(void 0)}),[v,c,i,L,$,null==o?void 0:o.unclaimedReward]),H=(0,p.useMemo)((()=>i?(0,x.D1)(i,null==o?void 0:o.unclaimedReward):[]),[i,null==o?void 0:o.unclaimedReward]),F=(0,p.useCallback)((a=>()=>{W(void 0),c(a)}),[c]),B=(0,p.useMemo)((()=>e?(0,x.VN)(e.chain,e.type).map((a=>a===x.Ff.UNSTAKE?{action:x.Ff.UNSTAKE,backgroundIconColor:"magenta-6",icon:E.Z,label:"Unstake funds",onClick:F(`/transaction/unstake/${e.type||l.EN}/${e.chain||l.EN}`)}:a===x.Ff.WITHDRAW?{action:x.Ff.WITHDRAW,backgroundIconColor:"geekblue-6",icon:T.Z,label:"Withdraw",onClick:O}:a===x.Ff.CLAIM_REWARD?{action:x.Ff.CLAIM_REWARD,backgroundIconColor:"green-7",icon:w.Z,label:"Claim rewards",onClick:K}:a===x.Ff.CANCEL_UNSTAKE?{action:x.Ff.CANCEL_UNSTAKE,backgroundIconColor:"purple-8",icon:y.Z,label:"Cancel unstake",onClick:F(`/transaction/cancel-unstake/${e.type||l.EN}/${e.chain||l.EN}`)}:{action:x.Ff.STAKE,backgroundIconColor:"green-6",icon:I.Z,label:"Stake more",onClick:F(`/transaction/stake/${e.type||l.EN}/${e.chain||l.EN}`)})):[]),[e,K,O,F]),U=(0,s.Ey)(null==g?void 0:g.address),P=(0,p.useCallback)(((a,e)=>{const t=()=>{W(a),e()};return()=>{U(t)()}}),[U]);return(0,Z.jsx)(C.ZP,{className:t,closable:!0,id:M,maskClosable:!0,onCancel:S?void 0:R,title:h("Actions"),children:B.map((a=>{const e=!H.includes(a.action),t=!!S,n=a.action===S,i=e||t&&!n;return(0,Z.jsx)(A.Z,{className:_()("action-more-item",{disabled:i}),leftItemIcon:(0,Z.jsx)(N.Z,{backgroundColor:m[a.backgroundIconColor],phosphorIcon:a.icon,size:"sm",weight:"fill"}),name:a.label,onPressItem:i?void 0:P(a.action,a.onClick),rightItem:n&&(0,Z.jsx)("div",{className:"loading-icon",children:(0,Z.jsx)(u.Z,{})})},a.label)}))})})).withConfig({displayName:"MoreActionModal",componentId:"sc-17oe78l-0"})((({theme:{token:a}})=>({".action-more-item:not(:last-child)":{marginBottom:a.marginXS},".ant-web3-block-right-item":{marginRight:0},".disabled":{cursor:"not-allowed",opacity:a.opacityDisable,".ant-web3-block":{cursor:"not-allowed"},".ant-web3-block:hover":{cursor:"not-allowed",background:a.colorBgSecondary}}})));var R=t(38014),D=t(54533),L=t(36926),$=t(60835),O=t(20029),K=t(58446),H=t(71871),F=t(11164),B=t(95798),U=t(92280),P=t(25690),z=t(89537),Q=t(27136);const V="staking-detail-modal-id",G=(0,b.ZP)((({chainStakingMetadata:a,className:e,nominatorMetadata:t,rewardItem:i,staking:l})=>{const{expectedReturn:o,minPoolBonding:r,minStake:u,unstakingPeriod:m}=a,{activeStake:h,address:k,chain:g,nominations:v,type:A,unstakings:N}=t,S=(0,x.tA)(g),E=D.H_.relay.includes(g),T=A===n.WQ.NOMINATED.valueOf()?"Nomination details":"Pooled details",{token:w}=(0,b.Fg)(),y=(0,f.s0)(),{t:I}=(0,j.$)(),[W,G]=(0,p.useState)(!1),{activeModal:X,inactiveModal:Y}=(0,p.useContext)(d.t),{currentAccount:J}=(0,s.v9)((a=>a.accountState)),q=(0,s.Ey)(null==J?void 0:J.address),aa=(0,H.Z)(l.chain),{decimals:ea}=(0,L.Nm)(aa),ta=(0,L.GS)(aa),na=(0,s.AT)(l.address),ia={nominated:I("Nominated"),pooled:I("Pooled")},la=(0,p.useCallback)((()=>{Y(V),setTimeout((()=>{y(`/transaction/stake/${t.type}/${t.chain}`)}),300)}),[Y,y,t]),oa=(0,p.useCallback)((()=>{Y(V),setTimeout((()=>y(`/transaction/unstake/${t.type}/${t.chain}`)),300)}),[Y,y,t]),sa=(0,p.useCallback)((()=>{X(M),Y(V)}),[X,Y]),ra=(0,p.useCallback)((()=>{G(!0)}),[]),ca=(0,p.useCallback)((()=>{G(!1),Y(V)}),[Y]),da=(0,p.useCallback)((a=>a===n.dE.EARNING_REWARD?K.C.active:a===n.dE.PARTIALLY_EARNING?K.C.partialEarning:a===n.dE.WAITING?K.C.waiting:K.C.inactive),[]),ua=(0,p.useCallback)((a=>{const e=((a,e)=>a.find((a=>a.validatorAddress===e)))(N,a.validatorAddress);return(0,Z.jsxs)($.Z,{hasBackgroundWrapper:!0,spaceSize:"sm",valueColorScheme:"light",children:[(0,Z.jsx)($.Z.Account,{address:a.validatorAddress,label:I("Validator"),name:a.validatorIdentity||(0,B.pC)(a.validatorAddress),networkPrefix:ta}),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Active staked"),suffix:l.nativeToken,value:a.activeStake||"",valueColorSchema:"gray"},a.validatorAddress),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Min stake"),suffix:l.nativeToken,value:a.validatorMinStake||"0",valueColorSchema:"gray"},a.validatorAddress),!!e&&"showByValidator"===S&&(0,Z.jsx)($.Z.Default,{className:"__para",label:I("Unstaked"),labelAlign:e.status===n.lz.UNLOCKING.valueOf()?"top":"center",children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)(P.Z,{className:"common-text text-light-4 text-right",decimal:ea,suffix:l.nativeToken,value:e.claimable}),e.status===n.lz.UNLOCKING.valueOf()&&(0,Z.jsx)("div",{className:"sm-text text-light-4",children:(0,F.H9)(e.waitingTime)})]})}),(0,Z.jsx)($.Z.Status,{label:I("Staking status"),statusIcon:da(a.status).icon,statusName:da(a.status).name,valueColorSchema:da(a.status).schema})]},a.validatorAddress)}),[ea,da,ta,S,l.nativeToken,I,N]);return(0,Z.jsxs)(C.ZP,{className:e,closable:!0,footer:(0,Z.jsxs)("div",{className:"staking-detail-modal-footer",children:[(0,Z.jsx)(U.Z,{icon:(0,Z.jsx)(c.Z,{phosphorIcon:z.Z}),onClick:sa,schema:"secondary"}),(0,Z.jsx)(U.Z,{className:"__action-btn",onClick:q(oa),schema:"secondary",children:I("Unstake")}),(0,Z.jsx)(U.Z,{className:"__action-btn",onClick:q(la),children:I("Stake more")})]}),id:V,maskClosable:!0,onCancel:ca,title:I(T),children:[(0,Z.jsxs)($.Z,{children:[(0,Z.jsx)($.Z.Account,{address:k,label:I("Account"),name:null==na?void 0:na.name}),(0,Z.jsx)($.Z.DisplayType,{label:I("Staking type"),typeName:ia[l.type]}),(0,Z.jsx)($.Z.Status,{label:A===n.WQ.NOMINATED?I("Nomination status"):I("Pooled status"),statusIcon:da(t.status).icon,statusName:da(t.status).name,valueColorSchema:da(t.status).schema}),!(null==i||!i.totalReward)&&parseFloat(null==i?void 0:i.totalReward)>0&&(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Total reward"),suffix:l.nativeToken,value:(null==i?void 0:i.totalReward)||"0"}),!(null==i||!i.unclaimedReward)&&parseFloat(null==i?void 0:i.unclaimedReward)>0&&(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Unclaimed reward"),suffix:l.nativeToken,value:(null==i?void 0:i.unclaimedReward)||"0"}),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Total staked"),suffix:l.nativeToken,value:String(parseFloat(h)+parseFloat(l.unlockingBalance||"0"))}),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Active staked"),suffix:l.nativeToken,value:h}),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Unstaked"),suffix:l.nativeToken,value:l.unlockingBalance||"0"}),(0,Z.jsx)($.Z.Chain,{chain:l.chain,label:I("Network")})]}),!W&&(0,Z.jsx)(U.Z,{block:!0,className:"see-more-btn",icon:(0,Z.jsx)(c.Z,{iconColor:w.colorTextLight4,phosphorIcon:Q.Z,size:"sm"}),onClick:ra,size:"xs",type:"ghost",children:I("See more")}),W&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)($.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:[!!o&&(0,Z.jsx)($.Z.Number,{label:I("Estimated earning"),suffix:"%",value:o,valueColorSchema:"even-odd"}),(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Minimum active"),suffix:l.nativeToken,value:t.type===n.WQ.NOMINATED?u:r||"0",valueColorSchema:"gray"}),!!m&&(0,Z.jsx)($.Z.Default,{label:I("Unstaking period"),valueColorSchema:"gray",children:(0,F.b_)(m)})]}),"showByValue"===S&&v&&v.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)($.Z,{valueColorScheme:"light",children:(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Active staked"),suffix:l.nativeToken,value:h})}),(0,Z.jsx)($.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:(0,Z.jsx)(Z.Fragment,{children:v.map((a=>E&&A===n.WQ.NOMINATED?(0,Z.jsx)($.Z.Default,{className:_()("__nomination-field","stand-alone"),label:(0,Z.jsx)(O.Z,{address:a.validatorAddress,className:"__nomination-label",name:a.validatorIdentity})},`${a.validatorAddress}-${a.activeStake}-${a.validatorIdentity||a.validatorMinStake||a.chain}`):(0,Z.jsx)($.Z.Number,{className:"__nomination-field",decimals:ea,label:(0,Z.jsx)(O.Z,{address:a.validatorAddress,className:"__nomination-label",name:a.validatorIdentity}),suffix:l.nativeToken,value:a.activeStake||"",valueColorSchema:"gray"},`${a.validatorAddress}-${a.activeStake}-${a.validatorIdentity||a.validatorMinStake||a.chain}`)))})})]}),("showByValue"===S||"mixed"===S)&&N&&N.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)($.Z,{valueColorScheme:"light",children:(0,Z.jsx)($.Z.Number,{decimals:ea,label:I("Unstaked"),suffix:l.nativeToken,value:l.unlockingBalance||"0"})}),(0,Z.jsx)($.Z,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:(0,Z.jsx)(Z.Fragment,{children:N.map((a=>(0,Z.jsx)($.Z.Number,{decimals:ea,label:(0,F.H9)(a.waitingTime)?I((0,F.H9)(a.waitingTime)):I("Withdraw"),suffix:l.nativeToken,value:a.claimable||"",valueColorSchema:"gray"},`${a.validatorAddress||a.chain}-${a.status}-${a.claimable}`)))})})]}),("showByValidator"===S||"mixed"===S)&&v&&v.length>0&&(null==J?void 0:J.address)!==R.Tt&&(0,Z.jsx)(Z.Fragment,{children:v&&v.length&&v.map((a=>ua(a)))})]})]})})).withConfig({displayName:"StakingDetailModal",componentId:"sc-1al54tx-0"})((({theme:{token:a}})=>({".staking-detail-modal-footer":{display:"flex",alignItems:"center"},".__action-btn":{flex:1},".__slash":{marginLeft:a.marginXXS,marginRight:a.marginXXS},".__inflation-text":{marginLeft:a.marginXXS,color:a.colorTextLight4},".__expected-return, .__inflation":{display:"inline-flex"},".__inflation":{color:a.colorTextLight4},".__nomination-field":{"> .__col":{overflow:"hidden"},"&.stand-alone":{".__col.-to-right":{flexGrow:0}}},".__nomination-label > .__col.-to-right":{flex:"initial",overflow:"hidden",alignItems:"flex-start",".__account-item":{width:"100%"},".__account-name":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},".see-more-btn":{marginTop:a.margin},".ant-sw-modal-body":{paddingBottom:0},".ant-sw-modal-footer":{border:"none"}}))),X="staking-filter-modal";var Y=function(a){return a.NOMINATED="nominated",a.POOLED="pooled",a}(Y||{});const J=[{label:"Nominated",value:n.WQ.NOMINATED},{label:"Pooled",value:n.WQ.POOLED}],q=(0,Z.jsx)(c.Z,{phosphorIcon:h.Z,size:"sm",type:"phosphor"}),aa=(0,Z.jsx)(c.Z,{phosphorIcon:k.Z,size:"sm",type:"phosphor"}),ea=(0,b.ZP)((function({className:a=""}){const e=(0,f.s0)(),{t}=(0,s.$G)(),h=(0,p.useContext)(o.R0),{activeModal:k,inactiveModal:b}=(0,p.useContext)(d.t),{data:x,priceMap:C}=(0,s.iu)(),{currentAccount:A}=(0,s.v9)((a=>a.accountState)),{filterSelectionMap:N,onApplyFilter:S,onChangeFilterOption:_,onCloseFilterModal:E,selectedFilters:T}=(0,s.RK)(X),[w]=(0,p.useState)(null==A?void 0:A.address),[y,I]=(0,p.useState)(void 0),[j,R]=p.useState(!1),D=(0,s.lm)(),L=(0,p.useMemo)((()=>a=>{if(!T.length)return!0;for(const e of T)if(e===Y.NOMINATED){if(a.staking.type===n.WQ.NOMINATED)return!0}else if(e===n.WQ.POOLED&&a.staking.type===n.WQ.POOLED)return!0;return!1}),[T]),$=(0,p.useCallback)((()=>{k(X)}),[k]),O=(0,p.useCallback)((a=>{I(a),k(M)}),[k]),K=(0,p.useCallback)((a=>{I(a),setTimeout((()=>{k(V)}),100)}),[k]),H=(0,s.Ey)(null==A?void 0:A.address),F=(0,p.useMemo)((()=>[{icon:aa,disabled:j,size:"sm",onClick:()=>{R(!0),D({icon:(0,Z.jsx)(u.Z,{size:32}),style:{top:210},direction:"vertical",duration:1.8,message:t("Reloading")}),(0,r.TU)({data:"staking"}).then((()=>{R(!1)})).catch(console.error)}},{icon:q,onClick:H((()=>e(`/transaction/stake/${l.EN}/${l.EN}`)))}]),[j,H,D,t,e]),B=(0,p.useCallback)((a=>(0,Z.jsx)(i.Jf,{className:"staking-item",decimals:a.decimals,onClickItem:K,onClickRightIcon:O,priceMap:C,stakingData:a},`${a.staking.chain}-${a.staking.type}-${a.staking.address}`)),[K,O,C]),U=(0,p.useCallback)(((a,e)=>{const t=e.toLowerCase();return a.staking.nativeToken.toLowerCase().includes(t)}),[]),P=(0,p.useCallback)((()=>(0,Z.jsx)(i.rf,{emptyMessage:t("Your staking accounts will appear here!"),emptyTitle:t("No staking"),phosphorIcon:g.Z})),[t]);return(0,p.useEffect)((()=>{(null==A?void 0:A.address)!==w&&(b(M),b(V),I(void 0))}),[w,null==A?void 0:A.address,b,e]),(0,Z.jsx)(i.FE,{className:`staking ${a}`,resolve:h.awaitStores(["staking","price"]),children:(0,Z.jsxs)(i.Ar.Base,{showSubHeader:!0,subHeaderBackground:"transparent",subHeaderCenter:!1,subHeaderIcons:F,subHeaderPaddingVertical:!0,title:t("Staking"),children:[(0,Z.jsx)(m.Z.Section,{actionBtnIcon:(0,Z.jsx)(c.Z,{phosphorIcon:v.Z,size:"sm"}),enableSearchInput:!0,filterBy:L,list:x,onClickActionBtn:$,renderItem:B,renderWhenEmpty:P,searchFunction:U,searchMinCharactersCount:2,searchPlaceholder:t("Search project"),showActionBtn:!0}),(0,Z.jsx)(i.Dd,{id:X,onApplyFilter:S,onCancel:E,onChangeOption:_,optionSelectionMap:N,options:J}),!!(y&&y.nominatorMetadata&&y.chainStakingMetadata)&&(0,Z.jsx)(G,{chainStakingMetadata:y.chainStakingMetadata,nominatorMetadata:y.nominatorMetadata,rewardItem:y.reward,staking:y.staking}),!!(y&&y.nominatorMetadata&&y.chainStakingMetadata)&&(0,Z.jsx)(W,{chainStakingMetadata:y.chainStakingMetadata,nominatorMetadata:y.nominatorMetadata,reward:y.reward,staking:y.staking})]})})})).withConfig({displayName:"Staking",componentId:"sc-18loehm-0"})((({theme:{token:a}})=>({color:a.colorTextLight1,fontSize:a.fontSizeLG,".ant-sw-screen-layout-body":{display:"flex"},".ant-sw-list-section":{flex:1},".staking__filter_option":{width:"100%"},".staking__filter_option_wrapper":{display:"flex",flexDirection:"column",gap:a.marginLG},".staking-item":{marginBottom:a.marginXS}}))),ta=ea}}]);